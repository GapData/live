---
title: "Creating neighbourhoods and training models"
author: "Mateusz Staniak"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating neighbourhoods and training models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r libk, echo = FALSE, include = FALSE}
library(knitr)
opts_knit$set(message = FALSE, warning = FALSE)
library(dplyr)
library(live)
library(mlr)
library(forestplot)
library(partykit)
```

### Example dataset

<!-- The _live_ package contains a subset of data on PISA tests provided by OECD. -->
<!-- It's called _actionTimeScoreMathRand1C_. -->
For illustration we'll use _Boston_ dataset from _MASS_ package. 

### Simulating datasets for local exploration

LIME method requires creating a new dataset of observations similar in some sense to a given original observation.
This process is implemented in _generateNeighbourhood_ function, which is called by _whiteBoxify_ function, but can be also used separately.

Observation of interest:

```{r obsEx}
kable(Boston[10, ])
```

### Predictions

First, we'll train a model on original observations using _mlr_ interface.
For illustration a neural net model will be used.
Package _nnet_ needs to be loaded first.

```{r train}
library(nnet)
ex <- whiteboxify(data = Boston,
                  newData = Boston[10, ],
                  explainedVar = "medv",
                  blackBox = "regr.nnet",
                  whiteBox = "dtree",
                  noOfNeighbours = 100)
```

This function returns a _live_ object which inherits from data.frame.
Calling _plot()_ with objects of this type gives a forest plot for linear regression white box and _ctree_ plot for decision tree.

```{r plotResult}
plot(ex)
```

