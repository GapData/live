---
title: "Creating neighbourhoods and training models"
author: "Mateusz Staniak"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating neighbourhoods and training models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r libk, echo = FALSE, include = FALSE}
library(knitr)
opts_knit$set(message = FALSE, warning = FALSE)
library(dplyr)
library(live)
library(mlr)
library(forestplot)
library(partykit)
```

### Example dataset

<!-- The _live_ package contains a subset of data on PISA tests provided by OECD. -->
<!-- It's called _actionTimeScoreMathRand1C_. -->
For illustration we'll use _Boston_ dataset from _MASS_ package. 

### Simulating datasets for local exploration

LIME method requires creating a new dataset of observations similar in some sense to a given original observation.
This process is implemented in _generateNeighbourhood_ function, which is called by _whiteBoxify_ function, but can be also used separately.

Observation of interest:

```{r obsEx}
kable(Boston[10, ])
```

### Predictions

First, we'll train a model on original observations using _mlr_ interface.
For illustration a SVM model will be used.
Package _kernlab_ needs to be loaded first.

```{r train}
library(kernlab)
ex <- simulateSimilar(data = Boston,
                  newData = Boston[20, ],
                  explainedVar = "medv",
                  blackBox = "regr.ksvm",
                  size = 500)
```

This function returns a _list_, which contains generated dataset, name of the explained variable and a name of used black box model. 
Now predictions from the black box model can be approximated locally by a simpler model, in this case,linear regression.
This is done by _exTrain_ function.

```{r trainWhite}
exTrain <- trainWhiteBox(liveObject = ex,
			 whiteBox = "regr.lm")
```

This function returns a _lm_ object if linear regression was chosen and _party_ object, if decision tree was the white box.
This simpler model can be plotted using plotWhiteBox function.

```{r plotWhite}
plotWhiteBox(exTrain, Boston[20, ])
```

The same can be done with decision tree serving as a white box.
We'll use _Iris_ dataset for illustration.
We need to modify the call to _simulateSimilar_ and _trainWhiteBox_ functions:

```{r trainTree}
data(iris)
exClassif <- simulateSimilar(data = iris,
				newData = iris[20, ],
				explainedVar = "Species",
				blackBox = "classif.ksvm",
				size = 500)
exClassifWB <- trainWhiteBox(exClassif, "classif.ctree", 6)
```


The _maxDepth_ argument controls the size of tree.
Now the tree can be plotted.

```{r plotTree}
plotWhiteBox(exClassifWB)
```
